drop table if exists "public".aux_regraencerramentonaturezaorcamentaria;
CREATE TABLE IF NOT EXISTS "public".aux_regraencerramentonaturezaorcamentaria
(
  c117_sequencial INTEGER
, c117_anousu INTEGER
, c117_instit INTEGER
, c117_contadevedora VARCHAR(15)
, c117_contacredora VARCHAR(15)
, c117_contareferencia VARCHAR(1)
);
TRUNCATE TABLE "public".aux_regraencerramentonaturezaorcamentaria;

INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221201','5221101','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221303','5221101','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','62211','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5321','5322','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','5221399','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5212101','6212','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','6221305','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','5221904','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5321','6322','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221301','5221399','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221904','5221101','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5311','5312','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','661304','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'52111','6212','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221302','5221399','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221303','5221399','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','6221303','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'72111','82114','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'52111','6211','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'6221305','6221301','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','6221307','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','5221904','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'6221307','6221303','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221201','5221904','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'6212','6211','D');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5221101','6221304','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5312','63199','C');
INSERT INTO "public".aux_regraencerramentonaturezaorcamentaria(c117_sequencial, c117_anousu, c117_instit, c117_contadevedora, c117_contacredora, c117_contareferencia) VALUES (1,1,1,'5311','6314','C');

CREATE OR REPLACE FUNCTION cria_regras_encerramento() RETURNS integer AS
$BODY$
DECLARE

    rRecordInstit record;

BEGIN

    delete from regraencerramentonaturezaorcamentaria;

    FOR rRecordInstit IN SELECT DISTINCT codigo FROM db_config
    LOOP

	insert into regraencerramentonaturezaorcamentaria
        select nextval('regraencerramentonaturezaorcamentaria_c117_sequencial_seq'),
        2015,
        rRecordInstit.codigo,
        c117_contadevedora,
        c117_contacredora
        from aux_regraencerramentonaturezaorcamentaria;

    END LOOP;
    RETURN 1;
END
$BODY$
LANGUAGE 'plpgsql' ;

select fc_startsession();
begin;
select cria_regras_encerramento();
commit;